# SurrealDB Docker Compose for development and testing
# Usage:
#   make db-up       # Start SurrealDB (in-memory, port 8000)
#   make db-cluster  # Start multi-node cluster
#
# Note: SurrealDB official image is minimal (distroless) and doesn't include
# curl or shell. Healthcheck is done externally via wait-for-healthy.sh script.

services:
  # =============================================================================
  # Main instance (in-memory, ephemeral)
  # Used for local development, integration tests, Jupyter notebooks, and CI.
  # Data is lost when the container stops â€” clean slate every time.
  # =============================================================================
  surrealdb:
    image: surrealdb/surrealdb:latest
    container_name: surrealdb-orm
    ports:
      - "8000:8000"
    command: start --log warn --user root --pass root memory
    networks:
      - surrealdb-net

  # =============================================================================
  # Multi-node cluster for K8s simulation / distributed testing
  # Activated with: docker compose --profile cluster up -d
  # =============================================================================
  surrealdb-node1:
    image: surrealdb/surrealdb:latest
    container_name: surrealdb-node1
    ports:
      - "8002:8000"
    command: start --log info --user root --pass root memory
    profiles:
      - cluster
    networks:
      - surrealdb-net

  surrealdb-node2:
    image: surrealdb/surrealdb:latest
    container_name: surrealdb-node2
    ports:
      - "8003:8000"
    command: start --log info --user root --pass root memory
    profiles:
      - cluster
    networks:
      - surrealdb-net

  surrealdb-node3:
    image: surrealdb/surrealdb:latest
    container_name: surrealdb-node3
    ports:
      - "8004:8000"
    command: start --log info --user root --pass root memory
    profiles:
      - cluster
    networks:
      - surrealdb-net

networks:
  surrealdb-net:
    driver: bridge
