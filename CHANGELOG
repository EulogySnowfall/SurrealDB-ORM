# Changelog

All notable changes to this project will be documented in this file.
This file follows the [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) format
and adheres to [SemVer](https://semver.org/) versioning.

---

## [0.14.4] - 2026-02-19

### Fixed

- **Datetime Serialization Round-Trip** (HIGH) — Python `datetime` objects were serialized as plain ISO 8601 strings during `save()` and `merge()`, causing silent type mismatches with SurrealDB `TYPE datetime` and `TYPE option<datetime>` schema fields. Two fixes:
  - **`_restore_datetime_fields()`** — After `model_dump()` in `save()` and `update()`, re-injects original `datetime` objects from the model instance if Pydantic stringified them. Ensures datetime objects reach the CBOR encoder as native datetime values (properly encoded as `CBORTag(12, iso_string)`).
  - **`inline_dict_variables()` datetime support** — `_extract_datetime_values()` recursively replaces `datetime` objects with `__SURQL_DT_N__` placeholder markers before `json.dumps()`, then post-replaces them with `d"<iso>"` SurrealQL datetime literals.

### Added

- **Generic `QuerySet[T]`** — `QuerySet` is now a generic class parameterized by the model type. All terminal methods return properly typed instances:
  - `exec()` → `list[T]`, `get()` → `T`, `first()` → `T`, `all()` → `list[T]`
  - `bulk_create()` → `list[T]`, `live()` → `LiveModelStream[T]`, `changes()` → `ChangeModelStream[T]`
  - `objects()` returns `QuerySet[Self]` — full type inference from model to query result
- **Typed `get_related()` via `@overload`** — Return type is now inferred from the `model_class` parameter:
  - `get_related("wrote", model_class=Book)` → `list[Book]`
  - `get_related("wrote")` → `list[dict[str, Any]]`
- **`_restore_datetime_fields()`** — Instance method on `BaseSurrealModel` that re-injects datetime objects after `model_dump()`.
- **`_extract_datetime_values()`** — Utility function in `utils.py` for recursive datetime placeholder extraction in inline dict variables.
- **10 new integration tests** — `tests/test_features_0_14_4.py` covering datetime round-trips (save, merge, inline, None), QuerySet typed returns, and `get_related()` typed returns.
- **24 new unit tests** — Covering `Generic QuerySet[T]`, `get_related()` overloads, `_restore_datetime_fields()`, `_extract_datetime_values()`, inline dict datetime handling, and `_is_datetime_field()`.

### Changed

- **mypy strict mode** — Enabled `strict = true` in `pyproject.toml`. All 64 source files pass mypy strict with zero errors.
- **Docker Compose pinned to SurrealDB v2.6** — All images in `devops/docker-compose.yml` pinned from `surrealdb/surrealdb:latest` to `surrealdb/surrealdb:v2.6` to prevent accidental use of incompatible versions.
- `QuerySet` class now inherits from `Generic[T]` with `T = TypeVar("T", bound="BaseSurrealModel")`.
- `objects()` classmethod return type changed from `QuerySet` to `QuerySet[Self]`.
- `get_related()` now has two `@overload` stubs with `_M = TypeVar("_M", bound="BaseSurrealModel")`.
- Multiple files updated for mypy strict compliance: `cli/commands.py`, `auth/mixins.py`, `cache.py`, `live.py`, `signals.py`, `subquery.py`, `prefetch.py`, `fields/computed.py`, `migrations/executor.py`.
- Version bump to 0.14.4

---

## [0.14.3] - 2026-02-15

### Fixed

- **Large Nested Dict Parameter Binding** (Issue #55) — SurrealDB v2.6's CBOR parameter binding silently drops complex nested structures (dicts with nested dicts/lists, lists of dicts), receiving `{}` instead of actual data. Two fixes:
  - **`save()` auto-routing**: `_execute_save()` now detects complex nested data via `_has_complex_nested_data()` and routes through a SET-clause query path (`_execute_save_with_set_clause()`) where each field is bound as a separate `$_sv_field` variable, avoiding the problematic single-object CBOR binding.
  - **`raw_query(inline_dicts=True)`**: New parameter on `raw_query()` that serializes complex dict/list variables as inline JSON in the query string, bypassing CBOR parameter binding entirely.

### Added

- **`_has_complex_nested_data(data)`** — Static method on `BaseSurrealModel` that detects dicts containing nested dicts/lists or lists containing dicts.
- **`_execute_save_with_set_clause()`** — New internal method that builds explicit `SET field = $_sv_field` queries for complex data, reusing `_build_set_clause()`.
- **`inline_dicts` parameter on `raw_query()`** — When `True`, complex dict/list variables are inlined as JSON in the query string.
- **`inline_dict_variables(query, variables)`** — New utility function in `utils.py` that replaces `$var` references with inline JSON for complex variables.
- **`_is_complex_value(value)`** — New utility function detecting nested dicts/lists.
- **`_SurrealJSONEncoder`** — JSON encoder in `utils.py` handling datetime, Decimal, UUID for inline serialization.
- **Integration tests** — `tests/test_issue_55.py` covering SDK and ORM save/query paths against real SurrealDB.
- **Unit tests** — `tests/test_issue_55_unit.py` covering detection heuristics, inline-dict helpers, JSON encoder, and save routing logic.

### Changed

- `_execute_save()` now checks `_has_complex_nested_data()` before the direct RPC path and routes to SET-clause path when needed.
- Version bump to 0.14.3

---

## [0.14.2] - 2026-02-15

### Fixed

- **CBOR None → NONE Encoding** (HIGH) — Python `None` was encoded as CBOR `null` (SurrealDB `NULL`) instead of `CBORTag(TAG_NONE)` (SurrealDB `NONE`). This caused `option<T>` fields on SCHEMAFULL tables to reject updates with `None` values. `_preprocess_for_cbor()` now recursively converts `None` to `CBORTag(TAG_NONE, None)` before `cbor2.dumps()`.
- **JSON Protocol None Handling** (HIGH) — Added `_strip_none_values()` to recursively strip `None` keys from dicts before JSON encoding, since JSON `null` maps to SurrealDB `NULL` and JSON has no `NONE` concept.
- **`validate_token()` Connection Overhead** (HIGH) — Added in-memory TTL cache (default 300s) to avoid creating an ephemeral HTTP connection on every call. Under concurrent web traffic, this previously caused connection refusals.

### Added

- **`validate_token_local()`** — New classmethod that decodes JWT payload locally (base64, no crypto verification) and extracts record ID from claims. Checks `exp` for expiry. Zero network calls — for trusted backend scenarios only.
- **`configure_token_cache(ttl=)`** — Classmethod to configure token validation cache TTL.
- **`invalidate_token_cache(token=)`** — Classmethod to clear cached token(s).
- **`flexible_fields` Config** — `SurrealConfigDict(flexible_fields=["game_state"])` as discoverable alternative to `Field(json_schema_extra={"flexible": True})` for migration `FLEXIBLE TYPE` generation.
- **38 new unit tests** — Full coverage for CBOR NONE encoding, JSON None stripping, token cache, `validate_token_local()`, `flexible_fields` introspection, and `validate_assignment` behavior.

### Changed

- **`validate_assignment=True`** — Enabled on `BaseSurrealModel.model_config`. Pydantic now validates field assignments, auto-coercing ISO 8601 strings to `datetime` objects on `model.field = "2026-02-13T10:00:00Z"`.
- `_introspect_field()` now accepts `model` parameter and checks `model_config.flexible_fields` in addition to `json_schema_extra`.
- `test_null_roundtrip` updated to expect absent field (NONE) instead of NULL value.
- Version bump to 0.14.2

---

## [0.14.1] - 2026-02-11

### Added

- **Typed Functions API in Notebook** — Added Section 1 to `examples/08_computed_functions.ipynb`
  - `db.fn.math.*` — `sqrt`, `pow`, `abs`, `ceil` demos
  - `db.fn.string.*` — `uppercase`, `len`, `concat` demos
  - `db.fn.time.*` — `now()` server timestamp demo
  - `db.fn.crypto.*` — `sha256`, `md5`, `argon2.generate` demos
  - `db.fn.array.*` — `len`, `distinct`, `flatten` demos
  - Dynamic namespace resolution demo (`db.fn.rand.int`)
  - SQL inspection via `FunctionCall.to_sql()`

### Changed

- Notebook `08_computed_functions.ipynb` reordered from simple to complex (Typed Functions API first)
- Sections renumbered: Typed Functions (1) → Computed Fields (2) → SurrealFunc (3) → extra_vars (4) → call_function (5) → raw_query (6)
- Version bump to 0.14.1

---

## [0.14.0] - 2026-02-11

### Added

- **Test Fixtures** — Declarative test data with automatic cleanup
  - `SurrealFixture` base class for declaring fixtures as class attributes
  - `@fixture` decorator scans class attributes for `BaseSurrealModel` instances
  - `load()` async context manager: saves all instances on enter, deletes them on exit
  - Fixture instances accessible by attribute name (e.g., `fixtures.alice`)
  - Deep-copies templates on each `load()` to avoid state leakage across calls
  - Duck-type detection for cross-import-path compatibility
  - New file: `src/surreal_orm/testing/fixtures.py`

- **Model Factories** — Factory Boy-style data generation with zero external dependencies
  - `ModelFactory` with `_FactoryMeta` metaclass for declarative factory definitions
  - `build()` / `build_batch(n)` — create in-memory instances (unit tests, no DB)
  - `create()` / `create_batch(n)` — create and save to DB (integration tests)
  - Override any field at call time: `create(role="admin")`
  - Built-in `Faker` with 14 providers: `name`, `first_name`, `last_name`, `email`, `random_int`, `random_float`, `text`, `sentence`, `word`, `uuid`, `boolean`, `date`, `datetime`, `choice`
  - New file: `src/surreal_orm/testing/factories.py`

- **QueryLogger** — Profile and debug all ORM queries with timing
  - `QueryLog` dataclass: `sql`, `variables`, `duration_ms`, `timestamp`
  - `QueryLogger` async context manager with `total_queries` and `total_ms` properties
  - Async-safe activation via `contextvars.ContextVar`
  - All query paths instrumented: `QuerySet.exec()`, `save()`, `update()`, `merge()`, `delete()`, `raw_query()`, `atomic_append/remove/set_add()`
  - New file: `src/surreal_orm/debug.py`

- **Testing Subpackage** — `surreal_orm.testing` with public exports
  - `from surreal_orm.testing import SurrealFixture, fixture, ModelFactory, Faker`
  - New file: `src/surreal_orm/testing/__init__.py`

- **15 Themed Jupyter Notebooks** — Comprehensive examples in `examples/`
  - `00_setup` — Prerequisites, Docker, connection config
  - `01_models_crud` — Model definition, CRUD operations
  - `02_queries_filters` — Filters, Q objects, lookups
  - `03_aggregations` — Count, Sum, Avg, Min, Max, GROUP BY
  - `04_relations_graph` — ForeignKey, ManyToMany, graph traversal
  - `05_transactions_bulk` — Transactions, bulk operations, atomic ops
  - `06_signals` — Pre/post/around signals
  - `07_auth` — User tables, signup, signin, token validation
  - `08_computed_functions` — Computed fields, SurrealFunc, raw_query
  - `09_advanced_queries` — Subqueries, QueryCache
  - `10_search_vectors` — Vector search, full-text search, hybrid search
  - `11_geospatial` — GeoField, PointField, nearby(), GeoDistance
  - `12_realtime` — Live queries, change feeds
  - `13_migrations_schema` — Migration system, schema introspection
  - `14_testing_debug` — SurrealFixture, ModelFactory, QueryLogger

- **Shared Test Connection Constants** — Centralized in `tests/conftest.py`
  - `SURREALDB_URL`, `SURREALDB_WS_URL`, `SURREALDB_USER`, `SURREALDB_PASS`, `SURREALDB_NAMESPACE`
  - All env-variable-backed with sensible defaults
  - `SURREALDB_SKIP_CONTAINER` support for CI environments

### Changed

- Alpha → Beta transition (`Development Status :: 4 - Beta` classifier)
- `conftest.py` uses `/health` endpoint as primary readiness signal (no longer requires Docker container name check)
- `QuerySet.nearby()` validates coordinate types and tuple length
- `SurrealFixture.load()` uses `object.__new__(cls)` to avoid type checker warnings
- Version bump to 0.14.0

### Fixed

- **Notebook 05** — `async with SurrealDBConnectionManager.transaction()` → `async with await` (coroutine needs `await` before entering context manager)
- **Notebook 09** — `annotate()` with `Subquery` returns dicts via GROUP ALL path; rewrote to use `values().annotate()` pattern
- **Notebook 11** — SurrealDB cannot parse `$variable` references inside tuple constructors; geo coordinates now inlined in query string
- **Notebook 14** — `@fixture` decorator `isinstance()` failed across dual-import paths; added duck-type fallback check
- **CI pipeline** — Docker Compose service name `surrealdb-ci` → `surrealdb`
- Hardcoded URLs/credentials in 6 test files replaced with shared `conftest` constants

---

## [0.13.0] - 2026-02-10

### Added

- **DEFINE EVENT (Server-Side Triggers)** — Declarative server-side event triggers in migrations
  - `DefineEvent(name, table, when, then)` migration operation — generates `DEFINE EVENT ... WHEN ... THEN (...);`
  - `RemoveEvent(name, table)` migration operation
  - `EventState` dataclass for schema tracking
  - `parse_define_event()` parser for `DEFINE EVENT` statements
  - `SchemaState.diff()` detects event add/change/remove across tables
  - `DatabaseIntrospector` parses events from `INFO FOR TABLE`
  - `ModelCodeGenerator` adds informational event comments in generated models

- **Geospatial Fields & Queries** — Typed geometry fields and distance-based queries
  - `GeoField["point"]`, `GeoField["polygon"]`, `GeoField["linestring"]`, `GeoField["multipoint"]` type annotations
  - Convenience aliases: `PointField`, `PolygonField`, `LineStringField`, `MultiPointField`
  - `is_geo_field()` and `get_geo_info()` detection helpers
  - `QuerySet.nearby(field, point, max_distance)` — proximity filter using `geo::distance()`
  - `GeoDistance(field, point)` annotation helper — compatible with `annotate()` interface
  - `ModelCodeGenerator` generates `GeoField["X"]` for `geometry<X>` database types
  - New files: `src/surreal_orm/fields/geometry.py`, `src/surreal_orm/geo.py`

- **Materialized Views** — Read-only models backed by `DEFINE TABLE ... AS SELECT`
  - `SurrealConfigDict(view_query="SELECT ...")` for view configuration
  - Read-only guard: `save()`, `update()`, `merge()`, `delete()` raise `TypeError` on views
  - `CreateTable(view_query=...)` generates `DEFINE TABLE ... AS (...);`
  - `parse_define_table()` extracts `AS` clause as `view_query`
  - `SchemaState.diff()` detects view_query changes

- **TYPE RELATION Enforcement** — Graph edge constraints in migrations
  - `TableType.RELATION` and `TableType.ANY` added to enum
  - `SurrealConfigDict(relation_in=..., relation_out=..., enforced=True)` for relation config
  - `CreateTable` generates `TYPE RELATION IN table1 OUT table2 ENFORCED`
  - `parse_define_table()` extracts RELATION IN/OUT/ENFORCED clauses
  - `DatabaseIntrospector` populates relation fields from schema

### Changed

- `annotate()` type hint extended to accept `GeoDistance`
- `exec()` integrates geo distance WHERE clause in `_compile_query()`
- `ModelCodeGenerator` generates `view_query=`, `relation_in=`, `relation_out=`, `enforced=` in config
- Version bump to 0.13.0

---

## [0.12.0] - 2026-02-10

### Added

- **Vector Search** — First-class support for AI/RAG pipelines with SurrealDB HNSW indexes
  - `VectorField[dimension]` and `VectorField[dimension, "type"]` type annotations
  - `is_vector_field()` and `get_vector_info()` detection helpers
  - `QuerySet.similar_to(field, vector, limit, *, ef)` — KNN similarity search using `<|N|>` operator
  - Auto-adds `vector::distance::knn() AS _knn_distance` to SELECT and ORDER BY
  - Combined with `.filter()` for pre-filtered similarity search
  - New file: `src/surreal_orm/fields/vector.py`

- **Full-Text Search** — BM25 scoring, highlighting, and multi-field search
  - `QuerySet.search(**field_queries)` — FTS using `@N@` match operator
  - `SearchScore(ref)` — Annotation helper for `search::score(N)` BM25 relevance
  - `SearchHighlight(open_tag, close_tag, ref)` — Annotation helper for `search::highlight()`
  - Multi-field search with auto-incrementing match references
  - Compatible with `.filter()` and `.annotate()` for combined queries
  - New file: `src/surreal_orm/search.py`

- **Hybrid Search** — Reciprocal Rank Fusion combining vector + full-text search
  - `QuerySet.hybrid_search(vector_field, vector, text_field, text_query, ...)` — Uses `search::rrf()` for ranking fusion
  - Configurable `vector_limit`, `text_limit`, `rrf_k` parameters

- **HNSW Index Support** — Full migration support for vector indexes
  - `CreateIndex` expanded with `hnsw`, `dimension`, `dist`, `vector_type`, `efc`, `m`, `concurrently` parameters
  - Generates `DEFINE INDEX ... HNSW DIMENSION N DIST X TYPE Y EFC N M N;`
  - `IndexState` expanded with all HNSW parameters for schema diffing

- **Full-Text Index Support** — BM25 and highlights in migrations
  - `CreateIndex` expanded with `bm25` (bool or tuple) and `highlights` parameters
  - Generates `DEFINE INDEX ... SEARCH ANALYZER name BM25(k1, b) HIGHLIGHTS;`

- **Analyzer Operations** — Define and manage custom text analyzers
  - `DefineAnalyzer(name, tokenizers, filters)` migration operation
  - `RemoveAnalyzer(name)` migration operation
  - `AnalyzerState` dataclass for schema tracking
  - `SchemaState.analyzers` dict with full diff support (add/update/remove)
  - `parse_define_analyzer()` parser for `DEFINE ANALYZER` statements

- **Parser Enhancements** — `parse_define_index()` now parses HNSW, BM25, HIGHLIGHTS, CONCURRENTLY

- **Introspection Updates**
  - `DatabaseIntrospector` now parses analyzers from `INFO FOR DB`
  - `ModelCodeGenerator` generates `VectorField[dim]` annotations for HNSW-indexed fields

### Changed

- `annotate()` type hint extended to accept `SearchScore | SearchHighlight`
- `exec()` attaches extra fields (`_knn_distance`, search scores) to model instances
- Search-only annotations bypass GROUP BY path in `_execute_annotate()`
- Version bump to 0.12.0

---

## [0.11.0] - 2026-02-10

### Added

- **Subqueries** — Embed a QuerySet as a filter value in another QuerySet
  - `Subquery` class wrapping a `QuerySet` for inline sub-SELECT expressions
  - Parameterized variables remapped via shared counter to avoid collisions
  - Works with all filter operators (`__in`, `=`, etc.) and Q objects
  - Nested subqueries supported (subquery within a subquery)
  - Usable in `annotate()` for scalar sub-SELECT expressions
  - New file: `src/surreal_orm/subquery.py`

- **Query Cache** — TTL-based query result caching with auto-invalidation
  - `QueryCache` class-level singleton with `configure()`, `get()`, `set()`, `invalidate()`, `clear()`, `stats()`
  - SHA-256 cache keys from query string + variables + table name
  - FIFO eviction when `max_size` is reached
  - Auto-invalidation via `post_save`, `post_delete`, `post_update` signals
  - `QuerySet.cache(ttl=N)` method for opt-in caching per query
  - New file: `src/surreal_orm/cache.py`

- **Prefetch Objects** — Fine-grained control over `prefetch_related()` batching
  - `Prefetch` class with `relation_name`, `queryset`, and `to_attr` parameters
  - `prefetch_related()` now accepts both strings and `Prefetch` objects
  - `_execute_prefetch()` batch-fetches related records after main query
  - Results attached to parent instances via `object.__setattr__`
  - Custom QuerySet filters applied to the edge table query
  - New file: `src/surreal_orm/prefetch.py`

### Changed

- `annotate()` type hint extended to accept `Aggregation | Subquery`
- `_execute_annotate()` handles Subquery annotations as inline sub-SELECTs
- `_prefetch_related` type changed from `list[str]` to `list[str | Prefetch]`
- `exec()` now checks/stores cache and runs prefetch after main query
- Version bump to 0.11.0

---

## [0.10.0] - 2026-02-10

### Added

- **Schema Introspection** — Generate Python model code from an existing SurrealDB database
  - `generate_models_from_db(output_path=)` public API
  - `schema_diff(models=[...])` to compare Python models against live database
  - `DatabaseIntrospector` — Parses `INFO FOR DB` / `INFO FOR TABLE` into `SchemaState`
  - `ModelCodeGenerator` — Converts `SchemaState` to Python model source code
  - `define_parser` module — Parses DEFINE TABLE, FIELD, INDEX, ACCESS statements
  - Handles generic types, VALUE/ASSERT expressions, encrypted fields, FLEXIBLE, READONLY
  - CLI: `surreal-orm inspectdb` and `surreal-orm schemadiff` commands

- **Multi-Database Support** — Named connection registry for routing models to different databases
  - `ConnectionConfig` frozen dataclass for immutable connection settings
  - `add_connection("name", ...)` to register named connections
  - `using("name")` async context manager override (async-safe via `contextvars`)
  - `SurrealConfigDict(connection="name")` model-level connection routing
  - `get_connection_name()` priority: context var > model config > `"default"`
  - `list_connections()`, `get_config()`, `remove_connection()` registry management
  - Full backward compatibility: `set_connection()` delegates to `add_connection("default", ...)`

### Changed

- All query paths route through named connection (model, queryset, live, auth, relations)
- Version bump to 0.10.0

---

## [0.9.0] - 2026-02-10

### Added

- **Live Models** — ORM-level real-time subscriptions via WebSocket Live Queries
  - `QuerySet.live()` returns a typed async iterator yielding `ModelChangeEvent` instances
  - `ModelChangeEvent[T]` dataclass with `action`, `instance: T`, `record_id`, `changed_fields`, `raw`
  - `LiveModelStream[T]` async context manager + iterator wrapping SDK `LiveSelectStream`
  - Filter integration: QuerySet filters translate to live query WHERE clauses
  - `auto_resubscribe=True` for seamless WebSocket recovery
  - `diff=True` for receiving only changed fields (DIFF mode)

- **Change Feed Integration** — HTTP-based change data capture at the ORM level
  - `QuerySet.changes()` returns a typed async iterator for event streaming
  - `ChangeModelStream[T]` async iterator wrapping SDK `ChangeFeedStream`
  - Cursor tracking via `.cursor` property for resumable streaming
  - Configurable `poll_interval` and `batch_size` parameters

- **`post_live_change` Signal** — New signal fired on live query events

- **WebSocket Connection Manager** — Lazy WebSocket connection alongside HTTP
  - `SurrealDBConnectionManager.get_ws_client()` for manual access

### Changed

- Version bump to 0.9.0

---

## [0.8.0] - 2026-02-08

### Added

- **Computed Fields** — Server-side computed fields using `DEFINE FIELD ... VALUE <expression>`
  - `Computed[T] = Computed("expression")` — dual-use type annotation + default value
  - Auto-excluded from writes via `get_server_fields()`
  - Migration introspector generates VALUE clauses

### Fixed

- **Auth Module: Ephemeral Connections** (Critical) — `signup()`, `signin()`, `authenticate_token()` no longer mutate root singleton connection
- **Auth Module: Configurable Access Name** (High) — Access name configurable via `access_name` in `SurrealConfigDict`
- **Auth Module: `signup()` Returns Token** (High) — Now returns `tuple[Self, str]` (user + JWT)
- **Auth Module: `authenticate_token()` Fixed** (Medium) — Now returns `tuple[Self, str] | None`
  - Added `validate_token()` lightweight method returning `str | None`
  - SDK `authenticate()` RPC method added to `BaseSurrealConnection`

### Changed

- Version bump to 0.8.0

---

## [0.7.0] - 2026-02-08

### Added

- **`merge(refresh=False)`** — Skip the extra SELECT after UPDATE for fire-and-forget operations
- **`call_function()`** — Invoke custom SurrealDB stored functions from ORM
  - Available on `SurrealDBConnectionManager` and any model class
- **`extra_vars` on `save()` and `merge()`** — Bind additional query variables for SurrealFunc expressions
- **`fetch()` + FETCH clause** — Resolve record links inline to avoid N+1 queries
  - `select_related()` also maps to FETCH
- **`remove_all_relations()` with list support** — Remove multiple relation types in one call

### Changed

- Version bump to 0.7.0

---

## [0.6.0] - 2026-02-07

### Added

- **Q Objects for Complex Queries** - Django-style composable query expressions
  - `Q` class with `|` (OR), `&` (AND), and `~` (NOT) operators
  - Mix Q objects with regular kwargs in `filter()` calls
  - Recursive rendering of nested Q trees into SurrealQL WHERE clauses
  - New file: `src/surreal_orm/q.py`

- **Parameterized Filters (Security)** - All filter values bound as query variables
  - Filter values use `$_fN` auto-generated variable names instead of `repr()` string interpolation
  - Prevents SQL injection by never embedding values directly in query strings
  - Existing `$variable` references via `.variables()` remain fully backwards compatible
  - New shared `_render_condition()` method factored from `_compile_query()` and `_compile_where_clause()`

- **SurrealFunc for Server-Side Functions** - Embed raw SurrealQL expressions in save/update
  - `SurrealFunc(expression)` marker class for server-side function calls
  - `save(server_values={"field": SurrealFunc("time::now()")})` for save operations
  - `merge(field=SurrealFunc("time::now()"))` with automatic detection
  - `_build_set_clause()` helper generates `SET field = expression` with mixed parameterized/raw values
  - Falls back to raw `UPSERT/UPDATE ... SET ...` query when SurrealFunc values are present

- **`remove_all_relations()`** - Bulk relation deletion on model instances
  - `direction` parameter: `"out"` (default), `"in"`, or `"both"`
  - Transaction support via `tx` parameter
  - Identifier validation with `_SAFE_IDENTIFIER_RE`
  - Proper ID escaping with `format_thing()`

- **Django-style `-field` Ordering** - Shorthand for descending order
  - `order_by("-created_at")` is equivalent to `order_by("created_at", OrderBy.DESC)`
  - Fully backwards compatible: existing `order_by("field", OrderBy.DESC)` still works

### Fixed

- **`isnull` Lookup** - `filter(field__isnull=True)` now generates `field IS NULL` instead of `field IS True`
  - `filter(field__isnull=False)` correctly generates `field IS NOT NULL`

### Changed

- `_compile_query()` and `_compile_where_clause()` now use shared `_build_where_parts()` method
- Filter rendering extracted into `_render_condition()` static method (was duplicated)
- `_render_q()` added for recursive Q object compilation
- Version bump to 0.6.0

---

## [0.5.9] - 2026-02-07

### Added

- **Atomic Array Operations** — Server-side array mutations
  - `atomic_append(record_id, field, value)` — Append using `array::append()`
  - `atomic_remove(record_id, field, value)` — Remove using `-=` operator
  - `atomic_set_add(record_id, field, value)` — Add only if not present using `+=`

- **Transaction Conflict Retry** — `retry_on_conflict(max_retries=3)` decorator with exponential backoff + jitter
  - `TransactionConflictError` new exception subclass for conflict detection

- **Relation Direction Control** — `reverse` parameter for `relate()` and `remove_relation()`

- **New Query Lookup Operators**
  - `not_contains` → `CONTAINSNOT`
  - `containsall` → `CONTAINSALL`
  - `containsany` → `CONTAINSANY`
  - `not_in` → `NOT IN`

### Changed

- Version bump to 0.5.9

---

## [0.5.8] - 2026-02-05

### Added

- **Around Signals** — Generator-based middleware pattern for wrapping DB operations
  - `around_save`, `around_delete`, `around_update` signal types
  - Shared state between before/after logic via `yield`
  - Guaranteed cleanup with `try/finally`
  - Execution order: `pre_* → around(before) → DB operation → around(after) → post_*`

### Changed

- Version bump to 0.5.8

---

## [0.5.7] - 2026-02-05

### Added

- **Model Signals** — Django-style event hooks for model lifecycle operations
  - Signal types: `pre_save`, `post_save`, `pre_delete`, `post_delete`, `pre_update`, `post_update`
  - `Signal.connect(sender=None)` decorator and method for registering handlers
  - `Signal.send(sender, **kwargs)` for dispatching to handlers
  - `Signal.disconnect()`, `Signal.disconnect_all()`, `Signal.clear()` for cleanup

### Changed

- Version bump to 0.5.7

---

## [0.5.6] - 2026-02-04

### Fixed

- **Issue #8 bis: Numeric ID escaping in relation queries**
  - Fixed `get_related()`, `RelationQuerySet`, and `RelationInfo.get_traversal_query()` for IDs starting with digits
  - Now uses `escape_record_id()` for proper backtick escaping in graph traversal queries

### Changed

- Version bump to 0.5.6

---

## [0.5.5.3] - 2026-02-04

### Fixed

- **Issue #10: RecordId objects in non-id fields not converted to strings**
  - When using CBOR protocol, foreign key fields (like `user_id`, `table_id`) returned `RecordId` objects instead of strings
  - This caused Pydantic validation errors and application failures
  - Fix: `_preprocess_db_record()` now converts RecordId objects in ANY field to strings
  - For the `id` field: extracts just the id part (e.g., `"abc123"`)
  - For other fields: converts to "table:id" format (e.g., `"users:abc123"`)

### Changed

- `_convert_record_id_to_string()` - New helper function for converting RecordId objects
- `_update_from_db()` now also handles RecordId conversion in non-id fields
- Version bump to 0.5.5.3

---

## [0.5.5.2] - 2026-02-04

### Fixed

- **Issue #9 (CRITICAL): datetime_type Pydantic validation regression**
  - In v0.5.5.1, records with datetime fields failed Pydantic validation
  - `from_db()` silently returned dicts instead of model instances
  - Caused widespread application failures ("'dict' object has no attribute 'model_dump'")
  - Root cause: `from_db()` passed raw database data directly to Pydantic without preprocessing
  - Fix: Added `_preprocess_db_record()` method to handle datetime parsing and RecordId conversion

### Added

- **`BaseSurrealModel._preprocess_db_record()`** - New classmethod that preprocesses database records
  - Parses datetime fields in all formats:
    - ISO 8601 strings (JSON protocol)
    - Python datetime objects (CBOR protocol)
    - CBOR timestamp arrays `[seconds, nanoseconds]`
  - Converts RecordId objects from CBOR responses to string IDs
  - Called by `from_db()` before Pydantic validation

### Changed

- `from_db()` now uses `_preprocess_db_record()` for consistent handling with `_update_from_db()`
- Version bump to 0.5.5.2

---

## [0.5.5.1] - 2026-02-04

### Fixed

- **Issue #8 (CRITICAL): Record IDs starting with digits** - IDs like `7abc123` now properly escaped
  - SurrealDB interprets unquoted IDs starting with digits as number tokens, causing parse errors
  - New `escape_record_id()` utility escapes such IDs with backticks: `` `7abc123` ``
  - New `format_thing()` utility generates correct thing references: `` table:`7abc123` ``
  - All CRUD operations (`get()`, `save()`, `update()`, `merge()`, `delete()`) use proper escaping

- **Issue #3 (HIGH): CBOR protocol for HTTP connections**
  - HTTP connections now support and default to CBOR protocol
  - Fixes `data:` prefix strings being misinterpreted as record links
  - `HTTPConnection` accepts `protocol` parameter: `"cbor"` (default) or `"json"`
  - `SurrealDBConnectionManager.set_connection()` accepts `protocol` parameter

- **Issue #1 (HIGH): `QuerySet.get()` handles full record ID format**
  - `get("table:id")` now correctly extracts the ID part and queries the correct table
  - New `parse_record_id()` utility handles both formats: `"abc123"` and `"table:abc123"`
  - Handles escaped IDs correctly: `` "table:`7abc`" `` → `"7abc"`

- **Issue #7 (MEDIUM): `get_related()` with `direction="in"` returns correct results**
  - Changed from unreliable `SELECT ... FETCH` to `SELECT VALUE field.* FROM ... WHERE ...`
  - Both `direction="in"` and `direction="out"` now return full related records

- **`update()` table name bug** - Fixed incidental bug using class name instead of `table_name`
  - Was using `self.__class__.__name__` instead of `self.get_table_name()`
  - Models with custom `table_name` config now update correctly

### Added

- **New utility module** - `src/surreal_orm/utils.py` with record ID handling functions:
  - `needs_id_escaping(record_id)` - Check if ID needs backtick escaping
  - `escape_record_id(record_id)` - Escape ID with backticks if needed
  - `format_thing(table, record_id)` - Generate proper SurrealDB thing reference
  - `parse_record_id(full_id)` - Parse `table:id` format into components

### Changed

- HTTP connections default to CBOR protocol (same as WebSocket)
- All ORM CRUD methods use `format_thing()` for consistent ID handling
- Version bump to 0.5.5.1

---

## [0.5.5] - 2026-02-03

### Added

- **CBOR Protocol Support** - Binary protocol for WebSocket connections (Issue #3)
  - `cbor2` is now a **required dependency** (previously optional)
  - CBOR is the **default protocol** for WebSocket connections
  - Properly handles strings with `data:` prefix (no longer misinterpreted as record links)
  - Custom CBOR tags for SurrealDB types: `RecordId`, `Table`, `Duration`, `DateTime`, `UUID`, `Decimal`
  - `RPCRequest.to_cbor()` and `RPCResponse.from_cbor()` methods
  - Aligns with official SurrealDB SDK protocol behavior

- **`unset_connection_sync()` Method** (Issue #4)
  - Synchronous version of `unset_connection()` for non-async contexts
  - Useful in `atexit` handlers, `__del__` methods, and synchronous cleanup code
  - Clears connection settings without async `close()` call

- **Field Alias Support** (Issue #6)
  - Map Python field names to different database column names
  - Uses Pydantic `Field(alias="db_column_name")` syntax
  - `populate_by_name=True` set by default in `BaseSurrealModel`
  - All `model_dump()` calls use `by_alias=True` for database operations

### Changed

- **CBOR is now required** - `cbor2>=5.6.0` moved from optional to required dependency
- **CBOR is the default protocol** - WebSocket connections use `protocol="cbor"` by default
- Removed `[cbor]` optional extra from `pyproject.toml`
- Updated `WebSocketConnection` docstring to reflect CBOR as recommended protocol
- Version bump to 0.5.5

### Fixed

- **Issue #3** - Strings with `data:` prefix (like base64 images) no longer misinterpreted as record links
  - JSON protocol interprets `data:xxx` as `record<data>` type
  - CBOR protocol properly encodes strings without interpretation

---

## [0.5.4] - 2026-02-03

### Added

- **Record ID format handling** - `QuerySet.get()` now automatically handles both formats:
  - Just the ID: `get("abc123")`
  - Full SurrealDB format: `get("players:abc123")`

- **`remove_relation()` accepts string IDs** - Now accepts both model instances and string IDs:
  - Model instance: `await table.remove_relation("has_player", player_instance)`
  - String ID (full format): `await table.remove_relation("has_player", "players:abc123")`
  - String ID (just ID): `await table.remove_relation("has_player", "abc123")`

- **`raw_query()` class method** - Execute arbitrary SurrealQL queries from model class

### Changed

- Version bump to 0.5.4

---

## [0.5.3.3] - 2026-02-02

### Fixed

- **`from_db()` fields_set** — Fixed bug where `from_db()` marked all fields as "user-set", causing `exclude_unset=True` to include DB-loaded fields in subsequent saves. Now `from_db()` clears `__pydantic_fields_set__`.

### Changed

- Version bump to 0.5.3.3

---

## [0.5.3.2] - 2026-02-02

### Fixed

- **QuerySet table name** — Fixed critical bug where QuerySet used class name instead of configured `table_name` from `model_config`

### Changed

- `QuerySet.get()` signature now accepts both `id=` keyword and positional `id_item` parameter
- Version bump to 0.5.3.2

---

## [0.5.3.1] - 2026-02-02

### Fixed

- **Partial updates for persisted records** — `save()` now uses `merge()` for already-persisted records, only sending explicitly modified fields
- **datetime parsing from DB** — `_update_from_db()` auto-parses ISO 8601 datetime strings
- **`_db_persisted` flag** — Tracks new vs persisted records for correct save behavior

### Changed

- Version bump to 0.5.3.1

---

## [0.5.3] - 2026-02-02

### Added

- **`upsert()` Method** - New SDK method for create-or-update operations
  - Added to `BaseSurrealConnection` and all transaction types
  - Enables idempotent save behavior for existing records

- **`server_fields` Config Option** - Exclude server-generated fields from saves
  - New `server_fields` option in `SurrealConfigDict`
  - Automatically excludes fields like `created_at`, `updated_at` from save/update
  - Prevents datetime serialization errors on subsequent saves

- **`_update_from_db()` Helper** - Internal method for DB data loading
  - Updates model fields without marking them as user-set
  - Preserves `__pydantic_fields_set__` for correct `exclude_unset` behavior

### Fixed

- **Bug #2: NULL Values** - `exclude_unset=True` now works after loading from DB
  - `_update_from_db()` preserves original `__pydantic_fields_set__`
  - Subsequent saves don't include DB-loaded fields as user-set

- **Bug #7: save() Returns New Instance** - Now updates original instance
  - `save()` updates `self` attributes in place instead of returning new object
  - Uses `_update_from_db()` for consistent field handling

- **Bug #8: datetime Serialization for UPDATE** - Fixed via `server_fields`
  - Server-generated datetime fields excluded from save operations
  - No more "expected datetime" errors on second save

- **Bug #9: merge() Returns None** - Now returns `self`
  - `merge()` method signature updated to return `Self`
  - Updates local instance with merged data before returning

### Changed

- **`save()` Uses Upsert** - Idempotent behavior for existing records
  - When ID is set, `save()` now uses `upsert` instead of `create`
  - No more "record already exists" errors on duplicate saves
  - **Breaking:** save() with duplicate ID now updates instead of failing

- Version bump to 0.5.3

---

## [0.5.2] - 2026-02-01

### Added

- **FieldType Enum Improvements** - Enhanced type system for migrations
  - Added `NUMBER`, `SET`, `REGEX` types to `FieldType` enum
  - `generic(inner_type)` method for parameterized types (`array<string>`, `record<users>`)
  - `from_python_type(type)` class method for automatic type mapping
  - Comprehensive docstrings with SurrealDB type documentation

- **Migration Type Validation** - Strict type checking for field definitions
  - `AddField` and `AlterField` now accept `FieldType | str`
  - Validation rejects invalid type strings
  - Support for generic types and union types

### Fixed

- **datetime Serialization** (Bug #1) - Custom JSON encoder for RPC requests
  - `SurrealJSONEncoder` handles `datetime`, `date`, `time`, `Decimal`, `UUID`
  - HTTP connection now uses pre-encoded JSON to preserve custom types

- **NULL Values Override** (Bug #2) - Optional fields no longer override DB defaults
  - Changed `model_dump()` to use `exclude_unset=True` in save/update operations
  - Unset optional fields are not sent to the database

- **Fluent API** (Bug #3) - `connect()` now returns `Self` for method chaining
  - `HTTPConnection.connect()` and `WebSocketConnection.connect()` return `self`
  - Enables patterns like `await (await conn.connect()).signin(...)`

- **Session Cleanup** (Bug #5) - WebSocket callback tasks properly managed
  - Added `_callback_tasks` set to track active tasks
  - Tasks are cancelled and cleared in `_cleanup()` method

- **Parameter Alias** (Bug #4) - `username` alias for `user` parameter
  - `SurrealDBConnectionManager.set_connection()` accepts both `user` and `username`
  - Raises `ValueError` if neither is provided

- **Patch Version Increment** - Fixed version calculation for security patches
  - Now extracts semantic base version (x.y.z) from current version
  - Correctly increments to x.y.z.1, x.y.z.2, etc. instead of x.y.z.1.1

### Changed

- Version bump to 0.5.2

---

## [0.5.1] - 2026-02-01

### Added

- **Dependabot Security Workflows** - Automated dependency updates
  - Auto-merge for Dependabot PRs after CI passes
  - Patch version tagging (x.x.x.1, x.x.x.2, etc.) for security updates
  - Automatic GitHub releases for security patches

- **SurrealDB Security Monitoring** - Database vulnerability tracking
  - Daily checks for new SurrealDB releases
  - Automatic integration tests with new DB versions
  - Auto-update of DB requirements on security patches
  - Issue creation for compatibility failures

### Changed

- Version bump to 0.5.1

---

## [0.5.0] - 2026-02-01

### Added

- **Live Select Stream** - Async iterator pattern for real-time change notifications
  - `LiveSelectStream` class with `async with` context manager and `async for` iteration
  - `LiveChange` dataclass with `record_id`, `action`, `result`, `changed_fields`
  - `LiveAction` enum: `CREATE`, `UPDATE`, `DELETE`
  - WHERE clause support with parameterized queries
  - DIFF mode support for receiving only changed fields

- **Live Select Manager** - Callback-based multi-stream management
  - `LiveSelectManager` for managing multiple concurrent subscriptions
  - `watch(table, callback, where, params)` method for callback-based watching
  - `stop(live_id)` and `stop_all()` for subscription management
  - `active_streams` and `count` properties

- **Auto-Resubscribe** - Automatic Live Query reconnection
  - `auto_resubscribe` parameter for automatic reconnection after WebSocket disconnect
  - `LiveSubscriptionParams` dataclass for storing subscription state
  - `on_reconnect(old_id, new_id)` callback for resubscription notifications
  - Seamless recovery on K8s pod restarts and network interruptions

- **Typed Function Calls** - Pydantic/dataclass return type support
  - `call(function, params, return_type)` method on connections
  - Automatic conversion to Pydantic models and dataclasses
  - `fn::` prefix auto-normalization for user-defined functions
  - Support for built-in function namespaces (math::, time::, etc.)

### Changed

- Version bump to 0.5.0
- SDK `__init__.py` updated with new exports

---

## [0.4.0] - 2026-02-01

### Added

- **Relation Field Types** - Declarative relation definitions
  - `ForeignKey(to, on_delete, related_name)` - Single record reference
  - `ManyToMany(to, through, related_name)` - Multiple record reference
  - `Relation(edge, to, reverse)` - SurrealDB graph edges

- **Relation Operations** - Django-style relation management
  - `RelationManager` class for lazy loading and operations
  - `add(*objects)`, `remove(*objects)`, `set(objects)`, `clear()` methods
  - `all()`, `filter(**kwargs)`, `count()`, `contains(obj)` query methods

- **Graph Traversal** - SurrealDB graph capabilities
  - `RelationQuerySet` for chained multi-hop traversal
  - `graph_query(traversal)` for raw graph queries on QuerySet
  - `traverse(path)` method for graph path queries

- **Prefetch Related** - N+1 query prevention
  - `select_related(*relations)` - Eager load in same query
  - `prefetch_related(*relations)` - Separate optimized queries

- **Model Methods** - Low-level graph operations
  - `relate(relation, to, tx, **edge_data)` - Create graph edge
  - `remove_relation(relation, to, tx)` - Delete graph edge
  - `get_related(relation, direction, model_class)` - Query edges

- **Relation Helpers**
  - `is_relation_field()`, `is_foreign_key()`, `is_many_to_many()`, `is_graph_relation()`
  - `get_relation_info()` for metadata extraction
  - `RelationInfo` dataclass for relation metadata

### Changed

- Version bump to 0.4.0

---

## [0.3.1] - 2026-02-01

### Added

- **Bulk Operations** - Efficient batch operations
  - `bulk_create(instances, atomic=False, batch_size=None)` - Create multiple records
  - `bulk_update(data, atomic=False)` - Update matching records
  - `bulk_delete(atomic=False)` - Delete matching records
  - Transaction support with `atomic=True` for all-or-nothing operations

### Fixed

- ORDER BY clause position (now correctly placed before LIMIT/START in SurrealQL)
- Typo in error message: "primirary_key" corrected to "primary_key"

---

## [0.3.0] - 2026-02-01

### Added

- **ORM Transactions** - Transaction support integrated into ORM layer
  - `tx` parameter added to `save()`, `update()`, `merge()`, `delete()` methods
  - `Model.transaction()` class method shortcut for creating transactions
  - `SurrealDBConnectionManager.transaction()` context manager

- **Aggregations** - Django-style aggregation classes
  - `Count()` - Count records
  - `Sum(field)` - Sum field values
  - `Avg(field)` - Average field values
  - `Min(field)` - Minimum field value
  - `Max(field)` - Maximum field value

- **GROUP BY Support**
  - `values(*fields)` method for specifying GROUP BY fields
  - `annotate(**aggregations)` method for computed aggregations
  - GROUP ALL behavior when `annotate()` used without `values()`

- **QuerySet Aggregation Methods**
  - `count()` - Count matching records
  - `sum(field)` - Sum field values
  - `avg(field)` - Average field values
  - `min(field)` - Minimum field value
  - `max(field)` - Maximum field value

### Changed

- Version bump to 0.3.0

---

## [0.2.2] - 2026-02-01

### Added

- **Atomic Transactions** - Full transaction support with context manager
  - `HTTPTransaction` - Batched execution for stateless connections
  - `WebSocketTransaction` - Immediate execution with server-side transactions
  - Context manager with auto-commit on success, auto-rollback on exception
  - Transaction methods: `query()`, `create()`, `update()`, `delete()`, `relate()`
  - `TransactionError` exception with rollback status tracking

- **Typed Functions API** - Fluent interface for SurrealDB functions
  - `db.fn.namespace.function()` syntax for built-in functions
  - `db.fn.custom_function()` syntax for user-defined functions
  - Support for all built-in namespaces: `array`, `crypto`, `duration`, `geo`, `http`, `math`, `meta`, `object`, `parse`, `rand`, `session`, `string`, `time`, `type`, `vector`
  - Automatic parameter binding with variable namespacing

- **Test Infrastructure Improvements**
  - Automatic SurrealDB container lifecycle management in `conftest.py`
  - Container detection to avoid duplicate instances
  - Graceful container cleanup only when started by tests

### Changed

- Test coverage improved to 68.5%
- Updated SDK documentation with transactions and functions guides

### Fixed

- Mypy `no-any-return` errors in `functions.py`
- Unused imports and variables in test files
- Module path resolution for SDK exceptions in tests

---

## [0.2.1] - 2026-02-01

### Added

- **Django-style Migration System** - Complete migration framework for schema versioning
  - `MigrationGenerator` - Generates Python migration files from model changes
  - `MigrationExecutor` - Applies/rolls back migrations to database
  - `ModelIntrospector` - Extracts schema state from Pydantic models
  - `SchemaState` with diff algorithm to compute operations between states
  - Migration operations: `CreateTable`, `DropTable`, `AddField`, `DropField`, `AlterField`, `CreateIndex`, `DropIndex`, `DefineAccess`, `RemoveAccess`, `DataMigration`, `RawSQL`

- **CLI for Schema Management** (`surreal-orm` command, requires `pip install surrealdb-orm[cli]`)
  - `makemigrations` - Generate migration files from model changes
  - `migrate` - Apply pending schema migrations
  - `upgrade` - Apply data migrations (record transformations)
  - `rollback <target>` - Rollback to a specific migration
  - `status` - Show migration status
  - `sqlmigrate <migration>` - Show SQL without executing
  - `shell` - Interactive SurrealQL shell

- **Table Type Classification** (`TableType` enum)
  - `NORMAL` - Standard table (default)
  - `USER` - Authentication table (enforces SCHEMAFULL, generates DEFINE ACCESS)
  - `STREAM` - Real-time table with CHANGEFEED
  - `HASH` - Lookup/cache table (defaults to SCHEMALESS)

- **Encrypted Field Type** for password hashing
  - `Encrypted` - Type alias for encrypted string fields
  - `EncryptedField(algorithm)` - Factory for custom encryption algorithms
  - Supported algorithms: `argon2` (default), `bcrypt`, `pbkdf2`, `scrypt`
  - Auto-generates `crypto::<algorithm>::generate()` in schema

- **JWT Authentication Support** using SurrealDB's `DEFINE ACCESS ... TYPE RECORD`
  - `AuthenticatedUserMixin` - Mixin providing `signup()`, `signin()`, `authenticate_token()`, `change_password()`
  - `AccessDefinition` - Dataclass for access configuration
  - `AccessGenerator` - Generates DEFINE ACCESS from USER models
  - Configurable token/session durations

- **Extended Model Configuration** (`SurrealConfigDict`)
  - `table_type` - USER, STREAM, HASH, NORMAL
  - `schema_mode` - SCHEMAFULL / SCHEMALESS
  - `changefeed` - Duration string (e.g., "7d")
  - `permissions` - Row-level security expressions
  - `identifier_field` - Field for signin (default: "email")
  - `password_field` - Field for password (default: "password")
  - `token_duration` / `session_duration` - JWT lifetimes

- **Model Registry** - Auto-registration of models via `__init_subclass__`
  - `get_registered_models()` - Get all registered model classes
  - `clear_model_registry()` - Clear for testing

- **New Test Suites**
  - `test_types.py` - Tests for enums (14 tests)
  - `test_encrypted_field.py` - Tests for Encrypted type (18 tests)
  - `test_migrations_operations.py` - Tests for operations (40 tests)
  - `test_migrations_state.py` - Tests for state/diff (25 tests)
  - `test_migrations_introspector.py` - Tests for introspection (15 tests)
  - `test_migrations_generator.py` - Tests for file generation (17 tests)
  - `test_cli.py` - CLI command tests (21 tests)
  - `test_auth_unit.py` - Auth unit tests (37 tests)
  - `test_migrations_integration.py` - Integration tests (requires SurrealDB)
  - `test_auth_integration.py` - Auth integration tests (requires SurrealDB)

### Changed

- Test coverage improved from ~44% to 56%
- Added `click>=8.1.0` as optional dependency for CLI

### Fixed

- Mypy type errors in auth mixins and migration modules
- Ruff linting issues across codebase
- Dataclass property override issue in `AlterField` operation

---

## [0.2.0] - 2026-02-01

### Added

- **New `surreal_sdk` package** - Standalone SDK that can be published separately to PyPI as `surreal-sdk`
  - Has its own `pyproject.toml` and `README.md`
  - Can be installed independently: `pip install surreal-sdk`

- **New `surreal_sdk` module** - Custom Python SDK for SurrealDB independent of the official `surrealdb` package
  - `HTTPConnection` - Stateless HTTP-based connection, ideal for microservices and serverless
  - `WebSocketConnection` - Stateful WebSocket connection for real-time features and Live Queries
  - `ConnectionPool` - Connection pooling for high-throughput scenarios
  - `LiveQuery` and `LiveQueryManager` - Real-time Live Query subscriptions (WebSocket only)
  - `ChangeFeedStream` and `MultiTableChangeFeed` - CDC pattern for stateless microservices (HTTP)
  - `RPCRequest`, `RPCResponse`, `RPCError` - RPC protocol layer

- **Strongly-typed response classes** (replacing `Any` returns)
  - `QueryResponse` / `QueryResult` - For query operations
  - `RecordResponse` / `RecordsResponse` - For record CRUD operations
  - `AuthResponse` - For signin/signup authentication
  - `InfoResponse` - For database info operations
  - `DeleteResponse` - For delete operations
  - `LiveQueryId` - For live query UUID handling
  - `ResponseStatus` - Enum for OK/ERR status

- **Exception classes** for SDK
  - `SurrealDBError`, `ConnectionError`, `AuthenticationError`
  - `QueryError`, `TimeoutError`, `LiveQueryError`, `ChangeFeedError`

### Changed

- **🚀 ORM now uses custom SDK** - Removed dependency on official `surrealdb` package
  - `SurrealDBConnectionManager` now uses `HTTPConnection` from `surreal_sdk`
  - All ORM methods adapted to use typed responses (`RecordResponse`, `RecordsResponse`, etc.)
  - Removed `surrealdb>=0.4.1` from dependencies

- **Python version support**: Now requires Python 3.12+ (dropped 3.11, added 3.14)
- Updated `pyproject.toml` classifiers and tool configurations for Python 3.12/3.13/3.14
- Coverage threshold reduced to 35% to accommodate new SDK code

### Removed

- **Dependency on `surrealdb` package** - No longer required, fully replaced by custom `surreal_sdk`

### Fixed

- ID parsing from SurrealDB format (`table:id` → `id`)
- Test isolation with dedicated model classes per test

---

## [0.1.5] - 2025-01-20

- Add
  - Support Model.DoesNotExist Error

## [0.1.4] - 2025-01-20

- Improvement
  - New class init based on the pydantic 2.0 validators.

- Changed
  - Required id or primary_key model_config

- Fixed
  - Packaging setup.
  - Pydantic validators can be uses on the class
  - Error message on primary key with use of SurrealConfigDict

---

## [0.1.3] - 2025-01-07

- Fixed
  - Packaging fix.

---

## [0.1.0] - 2025-01-07

- Added
  - Init version with basic "Django" like ORM.
  - Basic test and standard form has been set.

---
*Format based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) and compliant with [SemVer](https://semver.org/).*
