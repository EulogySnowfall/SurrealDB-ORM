# Changelog

All notable changes to this project will be documented in this file.
This file follows the [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) format
and adheres to [SemVer](https://semver.org/) versioning.

---

## [0.2.2] - 2026-02-01

### Added

- **Atomic Transactions** - Full transaction support with context manager
  - `HTTPTransaction` - Batched execution for stateless connections
  - `WebSocketTransaction` - Immediate execution with server-side transactions
  - Context manager with auto-commit on success, auto-rollback on exception
  - Transaction methods: `query()`, `create()`, `update()`, `delete()`, `relate()`
  - `TransactionError` exception with rollback status tracking

- **Typed Functions API** - Fluent interface for SurrealDB functions
  - `db.fn.namespace.function()` syntax for built-in functions
  - `db.fn.custom_function()` syntax for user-defined functions
  - Support for all built-in namespaces: `array`, `crypto`, `duration`, `geo`, `http`, `math`, `meta`, `object`, `parse`, `rand`, `session`, `string`, `time`, `type`, `vector`
  - Automatic parameter binding with variable namespacing

- **Test Infrastructure Improvements**
  - Automatic SurrealDB container lifecycle management in `conftest.py`
  - Container detection to avoid duplicate instances
  - Graceful container cleanup only when started by tests

### Changed

- Test coverage improved to 68.5%
- Updated SDK documentation with transactions and functions guides

### Fixed

- Mypy `no-any-return` errors in `functions.py`
- Unused imports and variables in test files
- Module path resolution for SDK exceptions in tests

---

## [0.2.1] - 2026-02-01

### Added

- **Django-style Migration System** - Complete migration framework for schema versioning
  - `MigrationGenerator` - Generates Python migration files from model changes
  - `MigrationExecutor` - Applies/rolls back migrations to database
  - `ModelIntrospector` - Extracts schema state from Pydantic models
  - `SchemaState` with diff algorithm to compute operations between states
  - Migration operations: `CreateTable`, `DropTable`, `AddField`, `DropField`, `AlterField`, `CreateIndex`, `DropIndex`, `DefineAccess`, `RemoveAccess`, `DataMigration`, `RawSQL`

- **CLI for Schema Management** (`surreal-orm` command, requires `pip install surrealdb-orm[cli]`)
  - `makemigrations` - Generate migration files from model changes
  - `migrate` - Apply pending schema migrations
  - `upgrade` - Apply data migrations (record transformations)
  - `rollback <target>` - Rollback to a specific migration
  - `status` - Show migration status
  - `sqlmigrate <migration>` - Show SQL without executing
  - `shell` - Interactive SurrealQL shell

- **Table Type Classification** (`TableType` enum)
  - `NORMAL` - Standard table (default)
  - `USER` - Authentication table (enforces SCHEMAFULL, generates DEFINE ACCESS)
  - `STREAM` - Real-time table with CHANGEFEED
  - `HASH` - Lookup/cache table (defaults to SCHEMALESS)

- **Encrypted Field Type** for password hashing
  - `Encrypted` - Type alias for encrypted string fields
  - `EncryptedField(algorithm)` - Factory for custom encryption algorithms
  - Supported algorithms: `argon2` (default), `bcrypt`, `pbkdf2`, `scrypt`
  - Auto-generates `crypto::<algorithm>::generate()` in schema

- **JWT Authentication Support** using SurrealDB's `DEFINE ACCESS ... TYPE RECORD`
  - `AuthenticatedUserMixin` - Mixin providing `signup()`, `signin()`, `authenticate_token()`, `change_password()`
  - `AccessDefinition` - Dataclass for access configuration
  - `AccessGenerator` - Generates DEFINE ACCESS from USER models
  - Configurable token/session durations

- **Extended Model Configuration** (`SurrealConfigDict`)
  - `table_type` - USER, STREAM, HASH, NORMAL
  - `schema_mode` - SCHEMAFULL / SCHEMALESS
  - `changefeed` - Duration string (e.g., "7d")
  - `permissions` - Row-level security expressions
  - `identifier_field` - Field for signin (default: "email")
  - `password_field` - Field for password (default: "password")
  - `token_duration` / `session_duration` - JWT lifetimes

- **Model Registry** - Auto-registration of models via `__init_subclass__`
  - `get_registered_models()` - Get all registered model classes
  - `clear_model_registry()` - Clear for testing

- **New Test Suites**
  - `test_types.py` - Tests for enums (14 tests)
  - `test_encrypted_field.py` - Tests for Encrypted type (18 tests)
  - `test_migrations_operations.py` - Tests for operations (40 tests)
  - `test_migrations_state.py` - Tests for state/diff (25 tests)
  - `test_migrations_introspector.py` - Tests for introspection (15 tests)
  - `test_migrations_generator.py` - Tests for file generation (17 tests)
  - `test_cli.py` - CLI command tests (21 tests)
  - `test_auth_unit.py` - Auth unit tests (37 tests)
  - `test_migrations_integration.py` - Integration tests (requires SurrealDB)
  - `test_auth_integration.py` - Auth integration tests (requires SurrealDB)

### Changed

- Test coverage improved from ~44% to 56%
- Added `click>=8.1.0` as optional dependency for CLI

### Fixed

- Mypy type errors in auth mixins and migration modules
- Ruff linting issues across codebase
- Dataclass property override issue in `AlterField` operation

---

## [0.2.0] - 2026-02-01

### Added

- **New `surreal_sdk` package** - Standalone SDK that can be published separately to PyPI as `surreal-sdk`
  - Has its own `pyproject.toml` and `README.md`
  - Can be installed independently: `pip install surreal-sdk`

- **New `surreal_sdk` module** - Custom Python SDK for SurrealDB independent of the official `surrealdb` package
  - `HTTPConnection` - Stateless HTTP-based connection, ideal for microservices and serverless
  - `WebSocketConnection` - Stateful WebSocket connection for real-time features and Live Queries
  - `ConnectionPool` - Connection pooling for high-throughput scenarios
  - `LiveQuery` and `LiveQueryManager` - Real-time Live Query subscriptions (WebSocket only)
  - `ChangeFeedStream` and `MultiTableChangeFeed` - CDC pattern for stateless microservices (HTTP)
  - `RPCRequest`, `RPCResponse`, `RPCError` - RPC protocol layer

- **Strongly-typed response classes** (replacing `Any` returns)
  - `QueryResponse` / `QueryResult` - For query operations
  - `RecordResponse` / `RecordsResponse` - For record CRUD operations
  - `AuthResponse` - For signin/signup authentication
  - `InfoResponse` - For database info operations
  - `DeleteResponse` - For delete operations
  - `LiveQueryId` - For live query UUID handling
  - `ResponseStatus` - Enum for OK/ERR status

- **Exception classes** for SDK
  - `SurrealDBError`, `ConnectionError`, `AuthenticationError`
  - `QueryError`, `TimeoutError`, `LiveQueryError`, `ChangeFeedError`

### Changed

- **ðŸš€ ORM now uses custom SDK** - Removed dependency on official `surrealdb` package
  - `SurrealDBConnectionManager` now uses `HTTPConnection` from `surreal_sdk`
  - All ORM methods adapted to use typed responses (`RecordResponse`, `RecordsResponse`, etc.)
  - Removed `surrealdb>=0.4.1` from dependencies

- **Python version support**: Now requires Python 3.12+ (dropped 3.11, added 3.14)
- Updated `pyproject.toml` classifiers and tool configurations for Python 3.12/3.13/3.14
- Coverage threshold reduced to 35% to accommodate new SDK code

### Removed

- **Dependency on `surrealdb` package** - No longer required, fully replaced by custom `surreal_sdk`

### Fixed

- ID parsing from SurrealDB format (`table:id` â†’ `id`)
- Test isolation with dedicated model classes per test

---

## [0.1.5] - 2025-01-20

- Add
  - Support Model.DoesNotExist Error

## [0.1.4] - 2025-01-20

- Improvement
  - New class init based on the pydantic 2.0 validators.

- Changed
  - Required id or primary_key model_config

- Fixed
  - Packaging setup.
  - Pydantic validators can be uses on the class
  - Error message on primary key with use of SurrealConfigDict

---

## [0.1.3] - 2025-01-07

- Fixed
  - Packaging fix.

---

## [0.1.0] - 2025-01-07

- Added
  - Init version with basic "Django" like ORM.
  - Basic test and standard form has been set.

---
*Format based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) and compliant with [SemVer](https://semver.org/).*
